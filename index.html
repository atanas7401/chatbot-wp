<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>GPT –ß–∞—Ç–±–æ—Ç</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="chat-container">
    <button id="toggle-btn">üí¨</button>
    <div id="chat-window">
        <div class="chat-header">GPT –∞—Å–∏—Å—Ç–µ–Ω—Ç</div>
        <div id="messages"></div>
        <div class="chat-input">
            <input id="user-input" type="text" placeholder="–í–∞—à–µ—Ç–æ —Å—ä–æ–±—â–µ–Ω–∏–µ..." />
            <button id="send-btn">–ò–∑–ø—Ä–∞—Ç–∏</button>
        </div>
    </div>
</div>
<script>
const apiKey = "YOUR_API_KEY_HERE"; // –∑–∞–º–µ–Ω–µ—Ç–µ —Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–µ–Ω–∏—è –∫–ª—é—á
const contact = "\uD83D\uDCDE \u0415\u0412\u0420\u041E \u041F\u0420\u041E\u0415\u041A\u0422 \u041A\u041E\u041C\u0415\u0420\u0421 \u0415\u041E\u041E\u0414\n\u260E\uFE0F 0877 887 673\n\u2709\uFE0F atanas7401@gmail.com";
const systemPrompt = "–¢–∏ —Å–∏ –ø–æ–ª–µ–∑–µ–Ω GPT-4o –∞—Å–∏—Å—Ç–µ–Ω—Ç –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏.";
let history = [{role: 'system', content: systemPrompt}];

function toggle() {
    const win = document.getElementById('chat-window');
    win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
}

function addMessage(text, cls) {
    const div = document.createElement('div');
    div.className = cls;
    div.textContent = text;
    document.getElementById('messages').appendChild(div);
    document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
}

function send() {
    const input = document.getElementById('user-input');
    const text = input.value.trim();
    if (!text) return;
    addMessage(text, 'user');
    input.value = '';

    // –∞–∫–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –∫–∞–∑–≤–∞ "–±–ª–∞–≥–æ–¥–∞—Ä—è", "—á–∞–æ" –∏–ª–∏ "–¥–æ–≤–∏–∂–¥–∞–Ω–µ"
    const farewell = /(\b–±–ª–∞–≥–æ–¥–∞—Ä—è\b|\b—á–∞–æ\b|\b–¥–æ–≤–∏–∂–¥–∞–Ω–µ\b)/i.test(text);
    const payload = { model: 'gpt-4o', messages: history.concat({role: 'user', content: text}) };

    fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + apiKey },
        body: JSON.stringify(payload)
    })
    .then(r => r.ok ? r.json() : Promise.reject(r))
    .then(data => {
        let answer = data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message.content;
        if (!answer || !answer.trim()) {
            addMessage(contact, 'bot');
            return;
        }
        history.push({role:'user', content:text});
        history.push({role:'assistant', content:answer});
        if (farewell) answer += '\n\n' + contact;
        addMessage(answer, 'bot');
    })
    .catch(() => {
        addMessage(contact, 'bot');
    });
}

document.getElementById('toggle-btn').addEventListener('click', toggle);
document.getElementById('send-btn').addEventListener('click', send);
document.getElementById('user-input').addEventListener('keypress', (e)=>{ if(e.key==='Enter') send(); });
</script>
</body>
</html>
